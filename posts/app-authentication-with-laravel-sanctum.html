<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="manifest" href="/favicon/site.webmanifest"/><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#000000"/><link rel="shortcut icon" href="/favicon/favicon.ico"/><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-config" content="/favicon/browserconfig.xml"/><meta name="theme-color" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><meta name="description" content="A statically generated blog example using Next.js and Markdown."/><meta property="og:image" content="https://og-image.vercel.app/Next.js%20Blog%20Starter%20Example.png?theme=light&amp;md=1&amp;fontSize=100px&amp;images=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fnextjs-black-logo.svg"/><title>App Authentication with Laravel Sanctum | Next.js Blog Example with Markdown</title><meta property="og:image" content="/assets/blog/app-authentication-with-laravel-sanctum/cover.png"/><meta name="date" content="2020-01-11T19:51:00.322Z"/><meta name="next-head-count" content="17"/><link rel="preload" href="/_next/static/css/eb4c2a322b5e4e451d7a.css" as="style"/><link rel="stylesheet" href="/_next/static/css/eb4c2a322b5e4e451d7a.css" data-n-g=""/><link rel="preload" href="/_next/static/css/c25f187412c5f13cd8ce.css" as="style"/><link rel="stylesheet" href="/_next/static/css/c25f187412c5f13cd8ce.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.d2ae4074d0a54d95f68e.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.87599f097ee29829183b.js" as="script"/><link rel="preload" href="/_next/static/chunks/main-16077ccfe5cc6973aa9b.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-548605a624d0e69fe54c.js" as="script"/><link rel="preload" href="/_next/static/chunks/bc82bb883724fe5faad984d18f20974d5cb6d361.fc1dc17d973ecd703ba3.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/posts/%5Bslug%5D-8c19f52b3a53cda472a2.js" as="script"/></head><body class="dark:bg-black dark:text-gray-100"><div id="__next"><div class="min-h-screen"><main><div class="container mx-auto px-5"><h2 class="text-2xl md:text-4xl font-bold tracking-tight md:tracking-tighter leading-tight mb-20 mt-8"><a class="hover:underline" href="/">A Swift <span class="text-blue-600">Blog</span></a>.</h2><article class="mb-32"><h1 class="text-6xl md:text-7xl lg:text-8xl font-bold tracking-tighter leading-tight md:leading-none mb-6 text-center md:text-left">App Authentication with Laravel Sanctum</h1><div class="flex justify-start items-center mb-8"><span class="text-gray-100 dark:text-white bg-yellow-400 rounded py-1 px-3 mr-3 font-bold cursor-pointer">swift</span><span class="text-gray-100 dark:text-white bg-red-400 rounded py-1 px-3 mr-3 font-bold cursor-pointer">laravel</span></div><div class="mb-8 md:mb-16 sm:mx-0"><div class="sm:mx-0"><div class="shadow-small"><picture><source srcSet="/assets/blog/app-authentication-with-laravel-sanctum/cover-dark.png" media="(prefers-color-scheme: dark)"/><img src="/assets/blog/app-authentication-with-laravel-sanctum/cover.png" alt="Cover Image for App Authentication with Laravel Sanctum"/></picture></div></div></div><div class="max-w-2xl mx-auto"><div class="mb-6 text-lg"><time dateTime="2020-01-11T19:51:00.322Z">January	11, 2020</time></div></div><div class="max-w-2xl mx-auto"><div class="markdown-styles_markdown__1x9gM"><p>I often use Laravel to build the API that support the apps I build, because I can quickly create something that just works without writing too much code. However, dealing with authentication has (in my opinion) always been a cumbersome task.</p>
<p>So it doesn’t come as a surprise that after seeing <a href="https://twitter.com/taylorotwell/status/1215022507478138882?s=20">Taylor Otwell’s Tweet about Laravel Sanctum</a> (previously Laravel Airlock) I wanted to give this a try for authentication in a simple mobile application.</p>
<p>A quick introduction: Sanctum is a package for Laravel. It’s supposed to be a featherweight alternative to existing authentication methods (like Laravel Passport) for use in SPAs and simple APIs.</p>
<p>I’m going to briefly walk you through installing Sanctum, but if you run into any problems, please refer to the <a href="https://github.com/laravel/sanctum">documentation</a>. After installing Sanctum and building a simple authentication system with it, I’ll show you how to use it in your iOS app. I’ll assume you have basic Swift knowledge, and I won’t go in depth on creating the interface I’ll show in my screenshots.</p>
<h2>Installation</h2>
<p>I created a new Laravel project to test this. I’ll assume you know how to do this, but for more information please refer to the <a href="https://laravel.com/docs/8.x">Laravel documentation</a>. cd into the project directory and execute the following commands in your terminal:</p>
<pre><code class="hljs language-bash">composer require laravel/sanctum
php artisan vendor:publish
php artisan migrate</code></pre>
<p>We’re now ready to dive into the Laravel project to finalise setting up Sanctum.</p>
<p>In your <code>User</code> model, use the <code>HasApiTokens</code> trait as follows:</p>
<pre><code class="hljs language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">Laravel</span>\<span class="hljs-title">Sanctum</span>\<span class="hljs-title">HasApiTokens</span>;
<span class="hljs-comment">// Other imports omitted.</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Authenticatable</span>
</span>{
    <span class="hljs-keyword">use</span> <span class="hljs-title">HasApiTokens</span>, <span class="hljs-title">Notifiable</span>;
    <span class="hljs-comment">// Class body omitted.</span>
}</code></pre>
<h2>Routes</h2>
<p>Now that we’ve finished setting up, let’s create some routes. Add the following routes to your <code>routes/api.php</code> file:</p>
<pre><code class="hljs language-php">Route::prefix(<span class="hljs-string">'sanctum'</span>)->namespace(<span class="hljs-string">'API'</span>)->group(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    Route::post(<span class="hljs-string">'register'</span>, <span class="hljs-string">'AuthController@register'</span>);
    Route::post(<span class="hljs-string">'token'</span>, <span class="hljs-string">'AuthController@token'</span>);
});</code></pre>
<p>The user will use these two routes to register an account and to request their token (basically, to log in). Let’s create the <code>AuthController</code> and write the implementation of these routes. Run the following line in your terminal:</p>
<pre><code class="hljs language-bash">php artisan make:controller API\AuthController</code></pre>
<p>Open the <code>app/Http/Controllers/API/AuthController.php</code> file you just created and add the <code>register</code> function:</p>
<pre><code class="hljs language-php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">register</span>(<span class="hljs-params">Request <span class="hljs-variable">$request</span></span>)
</span>{ 
    <span class="hljs-comment">// 1 </span>
    <span class="hljs-variable">$validator</span> = Validator::make(<span class="hljs-variable">$request</span>->all(), [
        <span class="hljs-string">'name'</span> => [<span class="hljs-string">'required'</span>, <span class="hljs-string">'string'</span>, <span class="hljs-string">'max:255'</span>],
        <span class="hljs-string">'email'</span> => [<span class="hljs-string">'required'</span>, <span class="hljs-string">'string'</span>, <span class="hljs-string">'email'</span>, <span class="hljs-string">'max:255'</span>, <span class="hljs-string">'unique:users'</span>],
        <span class="hljs-string">'password'</span> => [<span class="hljs-string">'required'</span>, <span class="hljs-string">'string'</span>, <span class="hljs-string">'min:8'</span>],
        <span class="hljs-string">'device_name'</span> => [<span class="hljs-string">'required'</span>, <span class="hljs-string">'string'</span>]
    ]); 

    <span class="hljs-comment">// 2</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$validator</span>->fails()) {
        <span class="hljs-keyword">return</span> response()->json([<span class="hljs-string">'error'</span> => <span class="hljs-variable">$validator</span>->errors()], <span class="hljs-number">422</span>);
    }

    <span class="hljs-comment">// 3</span>
    <span class="hljs-variable">$input</span> = <span class="hljs-variable">$request</span>->all();
    <span class="hljs-variable">$input</span>[<span class="hljs-string">'password'</span>] = bcrypt(<span class="hljs-variable">$input</span>[<span class="hljs-string">'password'</span>]);
    <span class="hljs-variable">$user</span> = User::create(<span class="hljs-variable">$input</span>);

    <span class="hljs-comment">// 4</span>
    <span class="hljs-variable">$token</span> = <span class="hljs-variable">$user</span>->createToken(<span class="hljs-variable">$request</span>->device_name)->plainTextToken;

    <span class="hljs-keyword">return</span> response()->json([<span class="hljs-string">'token'</span> => <span class="hljs-variable">$token</span>], <span class="hljs-number">200</span>);
}</code></pre>
<p>Here’s a step by step breakdown of what this code does:</p>
<ol>
<li>We validate the incoming request.</li>
<li>Check the outcome of this validation. If it failed, return the errors in the response.</li>
<li>Hash the password and create the new <code>User</code>.</li>
<li>Create a token and save it so we can return it in the response.</li>
</ol>
<p>As you can see, performing a successful request to this endpoint will return the generated token in the body of the response. However, to make sure our users don’t need to create a new account whenever they want to use the app on another device, let’s create the function to allow our users to request their token:</p>
<pre><code class="hljs language-php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">token</span>(<span class="hljs-params">Request <span class="hljs-variable">$request</span></span>)
</span>{
    <span class="hljs-comment">// 1</span>
    <span class="hljs-variable">$validator</span> = Validator::make(<span class="hljs-variable">$request</span>->all(), [
        <span class="hljs-string">'email'</span> => [<span class="hljs-string">'required'</span>, <span class="hljs-string">'string'</span>, <span class="hljs-string">'email'</span>, <span class="hljs-string">'max:255'</span>],
        <span class="hljs-string">'password'</span> => [<span class="hljs-string">'required'</span>, <span class="hljs-string">'string'</span>, <span class="hljs-string">'min:8'</span>],
        <span class="hljs-string">'device_name'</span> => [<span class="hljs-string">'required'</span>, <span class="hljs-string">'string'</span>]
    ]);    
    
    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$validator</span>->fails()) {
        <span class="hljs-keyword">return</span> response()->json([<span class="hljs-string">'error'</span> => <span class="hljs-variable">$validator</span>->errors()], <span class="hljs-number">422</span>);
    }
    
    <span class="hljs-comment">// 2</span>
    <span class="hljs-variable">$user</span> = User::where(<span class="hljs-string">'email'</span>, <span class="hljs-variable">$request</span>->email)->first();
 
    <span class="hljs-comment">// 3</span>
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$user</span> || !Hash::check(<span class="hljs-variable">$request</span>->password, <span class="hljs-variable">$user</span>->password) {
        <span class="hljs-keyword">return</span> response()->json([<span class="hljs-string">'error'</span> => <span class="hljs-string">'The provided credentials are incorrect.'</span>], <span class="hljs-number">422</span>);
    }
    
    <span class="hljs-comment">// 4</span>
    <span class="hljs-keyword">return</span> response()->json([<span class="hljs-string">'token'</span> => <span class="hljs-variable">$user</span>->createToken(<span class="hljs-variable">$request</span>->device_name)->plainTextToken]);
}</code></pre>
<p>Here’s what this code does:</p>
<ol>
<li>We once again validate the request, and return the errors if validation fails.</li>
<li>We get the first <code>User</code> from our database for the submitted email address. The email is unique, so at most this will return one user.</li>
<li>If the user doesn’t exist (so the email was incorrect), or the password isn’t correct, we return an error the app can pick up.</li>
<li>We return the generated token.</li>
</ol>
<p>The scaffolding of our authentication is now complete! Let’s quickly create a route that’ll allow us to get the name of the logged in user.</p>
<p>In your <code>routes/api.php</code> file, add the following code:</p>
<pre><code class="hljs language-php">Route::middleware(<span class="hljs-string">'auth:sanctum'</span>)->get(<span class="hljs-string">'/name'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">Request <span class="hljs-variable">$request</span></span>) </span>{
    <span class="hljs-keyword">return</span> response()->json([<span class="hljs-string">'name'</span> => <span class="hljs-variable">$request</span>->user()->name]);
});</code></pre>
<p>Here we use the <code>'auth:sanctum'</code> middleware. This will make sure the api token is present in the headers of the request, and will return an error if it isn’t. When the request works, we can use <code>$request->user()</code> to get access to the user model.</p>
<p>There’s a lot more I’d like to write about the things we can easily do with Sanctum, but I’ll refrain from doing so to keep this article short. If you want to learn more about the possibilities, like adding <em>abilities</em> and revoking tokens, take a look at the <a href="https://github.com/laravel/sanctum">documentation</a>.</p>
<h2>Let’s authenticate</h2>
<p>hunter2 is not a valid password with the validation rules we defined.</p>
<p>It’s time to put our api to the test. Let’s open up Xcode and quickly whip up a login screen. After doing whatever client side validation you want to perform, pass the values from the fields in your register form to the function you’ll use to perform the HTTP request. To provide code that can be used regardless of your preferred architecture, I’ll simply show you how to construct the request to register a user. Make sure to include the <code>application/json</code> <code>Content-Type header</code>, or your requests won’t succeed.</p>
<pre><code class="hljs language-swift"><span class="hljs-keyword">var</span> request <span class="hljs-operator">=</span> <span class="hljs-type">URLRequest</span>(url: <span class="hljs-type">URL</span>(string: <span class="hljs-string">"http://yourprojecturl.test/api/sanctum/register"</span>)<span class="hljs-operator">!</span>)
request.httpMethod <span class="hljs-operator">=</span> <span class="hljs-string">"POST"</span>
request.addValue(<span class="hljs-string">"application/json"</span>, forHTTPHeaderField: <span class="hljs-string">"Content-Type"</span>)
<span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> body <span class="hljs-operator">=</span> <span class="hljs-keyword">try?</span> jsonEncoder.encode([
    <span class="hljs-string">"name"</span>: name,
    <span class="hljs-string">"password"</span>: password,
    <span class="hljs-string">"email"</span>: email,
    <span class="hljs-string">"device_name"</span>: deviceName
]) <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span>
}

request.httpBody <span class="hljs-operator">=</span> body</code></pre>
<p>The request to log in is very similar, we simply replace the final url endpoint with <code>/token</code> and remove the <code>name</code> from the body. A successful request to any of these endpoints will result in the following response body:</p>
<pre><code class="hljs language-json">{
 <span class="hljs-attr">"token"</span>: <span class="hljs-string">"&#x3C;api token>"</span>
}</code></pre>
<p>After your user registers their account or logs in, make sure to store this token somewhere. We’ll use it in this next request to retrieve their name from the backend:</p>
<pre><code class="hljs language-swift"><span class="hljs-keyword">var</span> request <span class="hljs-operator">=</span> <span class="hljs-type">URLRequest</span>(url: <span class="hljs-type">URL</span>(string: <span class="hljs-string">"http://yourprojecturl.test/api/name"</span>))
request.httpMethod <span class="hljs-operator">=</span> <span class="hljs-string">"GET"</span>
request.addValue(<span class="hljs-string">"Bearer <span class="hljs-subst">\(apiToken)</span>"</span>, forHTTPHeaderField: <span class="hljs-string">"Authorization"</span>)</code></pre>
<h2>A quick recap</h2>
<p>Let’s briefly go over the things I explained in this article, to make sure we’re on the same page.</p>
<ul>
<li>We set up some scaffolding with Laravel and Sanctum to handle user authentication.</li>
<li>We can create routes using the <code>'auth:sanctum'</code> middleware that will validate the token sent in the headers, and gives us access to the corresponding user model.</li>
<li>We can create the requests to consume our API.</li>
</ul>
<h2>Next steps</h2>
<p>As I mentioned before, this just scratches the surface of what we can do with Sanctum. You can create tokens with different abilities so some users can perform actions while others can’t. Or you can set the token to expire after a certain amount of time, so the user has to request a new one. Sanctum is still in beta, so expect things to change and new features to be added.</p>
<p>Hopefully this article gave you some insights in how Sanctum can be a simple alternative to other authorization methods. If you’re a mobile developer and you have never worked with Laravel before, I highly recommend spending some time with it. You’ll be able to build the backend for your apps in no time.</p>
<p>If you have any questions, the best way to reach out to me is through <a href="https://twitter.com/jillevd_w">Twitter</a>. If you like reading this, please let me know if you’d like to read more about Laravel, Swift, or a combination of the two.</p>
</div></div></article><section><h2 class="mb-8 text-6xl md:text-7xl font-bold tracking-tighter leading-tight">Related Posts</h2><div class="grid grid-cols-1 md:grid-cols-2 md:gap-x-16 lg:gap-x-32 gap-y-20 md:gap-y-32 mb-32"><div><div class="mb-5"><div class="sm:mx-0"><a aria-label="Dynamic Routing and Static Generation" href="/posts/dynamic-routing"><div class="shadow-small hover:shadow-medium transition-shadow duration-200"><picture><source srcSet="/assets/blog/dynamic-routing/cover.jpg" media="(prefers-color-scheme: dark)"/><img src="/assets/blog/dynamic-routing/cover.jpg" alt="Cover Image for Dynamic Routing and Static Generation"/></picture></div></a></div></div><h3 class="text-3xl mb-3 leading-snug"><a class="hover:underline" href="/posts/dynamic-routing">Dynamic Routing and Static Generation</a></h3><div class="flex justify-start items-center mb-4"><span class="text-gray-100 dark:text-white bg-yellow-400 rounded py-1 px-3 mr-3 font-bold cursor-pointer">swift</span></div><div class="text-lg mb-4"><time dateTime="2020-03-16T05:35:07.322Z">March	16, 2020</time></div></div><div><div class="mb-5"><div class="sm:mx-0"><a aria-label="Learn How to Pre-render Pages Using Static Generation with Next.js" href="/posts/hello-world"><div class="shadow-small hover:shadow-medium transition-shadow duration-200"><picture><source srcSet="/assets/blog/hello-world/cover.jpg" media="(prefers-color-scheme: dark)"/><img src="/assets/blog/hello-world/cover.jpg" alt="Cover Image for Learn How to Pre-render Pages Using Static Generation with Next.js"/></picture></div></a></div></div><h3 class="text-3xl mb-3 leading-snug"><a class="hover:underline" href="/posts/hello-world">Learn How to Pre-render Pages Using Static Generation with Next.js</a></h3><div class="flex justify-start items-center mb-4"><span class="text-gray-100 dark:text-white bg-yellow-400 rounded py-1 px-3 mr-3 font-bold cursor-pointer">swift</span><span class="text-gray-100 dark:text-white bg-purple-400 rounded py-1 px-3 mr-3 font-bold cursor-pointer">combine</span></div><div class="text-lg mb-4"><time dateTime="2020-03-16T05:35:07.322Z">March	16, 2020</time></div></div></div></section></div></main></div><footer class="bg-accent-1  dark:bg-black border-t border-accent-2 dark:border-gray-800"><div class="container mx-auto px-5"><div class="py-28 flex flex-col lg:flex-row items-center"><h3 class="text-4xl lg:text-5xl font-bold tracking-tighter leading-tight text-center lg:text-left mb-10 lg:mb-0 lg:pr-4 lg:w-1/2">Statically Generated with Next.js.</h3><div class="flex flex-col lg:flex-row justify-center items-center lg:pl-4 lg:w-1/2"><a href="https://nextjs.org/docs/basic-features/pages" class="mx-3 bg-black dark:bg-white hover:bg-white dark:hover:bg-black hover:text-black dark:hover:text-white border border-black dark:border-white text-white dark:text-black font-bold py-3 px-12 lg:px-8 duration-200 transition-colors mb-6 lg:mb-0">Read Documentation</a><a href="https://github.com/vercel/next.js/tree/canary/examples/blog-starter-typescript" class="mx-3 font-bold hover:underline">View on GitHub</a></div></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"App Authentication with Laravel Sanctum","date":"2020-01-11T19:51:00.322Z","tags":["swift","laravel"],"slug":"app-authentication-with-laravel-sanctum","author":{"name":"Jille van der Weerd","picture":"/assets/blog/authors/jj.jpeg"},"content":"\u003cp\u003eI often use Laravel to build the API that support the apps I build, because I can quickly create something that just works without writing too much code. However, dealing with authentication has (in my opinion) always been a cumbersome task.\u003c/p\u003e\n\u003cp\u003eSo it doesn’t come as a surprise that after seeing \u003ca href=\"https://twitter.com/taylorotwell/status/1215022507478138882?s=20\"\u003eTaylor Otwell’s Tweet about Laravel Sanctum\u003c/a\u003e (previously Laravel Airlock) I wanted to give this a try for authentication in a simple mobile application.\u003c/p\u003e\n\u003cp\u003eA quick introduction: Sanctum is a package for Laravel. It’s supposed to be a featherweight alternative to existing authentication methods (like Laravel Passport) for use in SPAs and simple APIs.\u003c/p\u003e\n\u003cp\u003eI’m going to briefly walk you through installing Sanctum, but if you run into any problems, please refer to the \u003ca href=\"https://github.com/laravel/sanctum\"\u003edocumentation\u003c/a\u003e. After installing Sanctum and building a simple authentication system with it, I’ll show you how to use it in your iOS app. I’ll assume you have basic Swift knowledge, and I won’t go in depth on creating the interface I’ll show in my screenshots.\u003c/p\u003e\n\u003ch2\u003eInstallation\u003c/h2\u003e\n\u003cp\u003eI created a new Laravel project to test this. I’ll assume you know how to do this, but for more information please refer to the \u003ca href=\"https://laravel.com/docs/8.x\"\u003eLaravel documentation\u003c/a\u003e. cd into the project directory and execute the following commands in your terminal:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ecomposer require laravel/sanctum\nphp artisan vendor:publish\nphp artisan migrate\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWe’re now ready to dive into the Laravel project to finalise setting up Sanctum.\u003c/p\u003e\n\u003cp\u003eIn your \u003ccode\u003eUser\u003c/code\u003e model, use the \u003ccode\u003eHasApiTokens\u003c/code\u003e trait as follows:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-php\"\u003e\u003cspan class=\"hljs-keyword\"\u003euse\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eLaravel\u003c/span\u003e\\\u003cspan class=\"hljs-title\"\u003eSanctum\u003c/span\u003e\\\u003cspan class=\"hljs-title\"\u003eHasApiTokens\u003c/span\u003e;\n\u003cspan class=\"hljs-comment\"\u003e// Other imports omitted.\u003c/span\u003e\n\u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eUser\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eAuthenticatable\u003c/span\u003e\n\u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003euse\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eHasApiTokens\u003c/span\u003e, \u003cspan class=\"hljs-title\"\u003eNotifiable\u003c/span\u003e;\n    \u003cspan class=\"hljs-comment\"\u003e// Class body omitted.\u003c/span\u003e\n}\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eRoutes\u003c/h2\u003e\n\u003cp\u003eNow that we’ve finished setting up, let’s create some routes. Add the following routes to your \u003ccode\u003eroutes/api.php\u003c/code\u003e file:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-php\"\u003eRoute::prefix(\u003cspan class=\"hljs-string\"\u003e'sanctum'\u003c/span\u003e)-\u003enamespace(\u003cspan class=\"hljs-string\"\u003e'API'\u003c/span\u003e)-\u003egroup(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n    Route::post(\u003cspan class=\"hljs-string\"\u003e'register'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'AuthController@register'\u003c/span\u003e);\n    Route::post(\u003cspan class=\"hljs-string\"\u003e'token'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'AuthController@token'\u003c/span\u003e);\n});\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe user will use these two routes to register an account and to request their token (basically, to log in). Let’s create the \u003ccode\u003eAuthController\u003c/code\u003e and write the implementation of these routes. Run the following line in your terminal:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ephp artisan make:controller API\\AuthController\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eOpen the \u003ccode\u003eapp/Http/Controllers/API/AuthController.php\u003c/code\u003e file you just created and add the \u003ccode\u003eregister\u003c/code\u003e function:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-php\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eregister\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eRequest \u003cspan class=\"hljs-variable\"\u003e$request\u003c/span\u003e\u003c/span\u003e)\n\u003c/span\u003e{ \n    \u003cspan class=\"hljs-comment\"\u003e// 1 \u003c/span\u003e\n    \u003cspan class=\"hljs-variable\"\u003e$validator\u003c/span\u003e = Validator::make(\u003cspan class=\"hljs-variable\"\u003e$request\u003c/span\u003e-\u003eall(), [\n        \u003cspan class=\"hljs-string\"\u003e'name'\u003c/span\u003e =\u003e [\u003cspan class=\"hljs-string\"\u003e'required'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'string'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'max:255'\u003c/span\u003e],\n        \u003cspan class=\"hljs-string\"\u003e'email'\u003c/span\u003e =\u003e [\u003cspan class=\"hljs-string\"\u003e'required'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'string'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'email'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'max:255'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'unique:users'\u003c/span\u003e],\n        \u003cspan class=\"hljs-string\"\u003e'password'\u003c/span\u003e =\u003e [\u003cspan class=\"hljs-string\"\u003e'required'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'string'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'min:8'\u003c/span\u003e],\n        \u003cspan class=\"hljs-string\"\u003e'device_name'\u003c/span\u003e =\u003e [\u003cspan class=\"hljs-string\"\u003e'required'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'string'\u003c/span\u003e]\n    ]); \n\n    \u003cspan class=\"hljs-comment\"\u003e// 2\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-variable\"\u003e$validator\u003c/span\u003e-\u003efails()) {\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e response()-\u003ejson([\u003cspan class=\"hljs-string\"\u003e'error'\u003c/span\u003e =\u003e \u003cspan class=\"hljs-variable\"\u003e$validator\u003c/span\u003e-\u003eerrors()], \u003cspan class=\"hljs-number\"\u003e422\u003c/span\u003e);\n    }\n\n    \u003cspan class=\"hljs-comment\"\u003e// 3\u003c/span\u003e\n    \u003cspan class=\"hljs-variable\"\u003e$input\u003c/span\u003e = \u003cspan class=\"hljs-variable\"\u003e$request\u003c/span\u003e-\u003eall();\n    \u003cspan class=\"hljs-variable\"\u003e$input\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e'password'\u003c/span\u003e] = bcrypt(\u003cspan class=\"hljs-variable\"\u003e$input\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e'password'\u003c/span\u003e]);\n    \u003cspan class=\"hljs-variable\"\u003e$user\u003c/span\u003e = User::create(\u003cspan class=\"hljs-variable\"\u003e$input\u003c/span\u003e);\n\n    \u003cspan class=\"hljs-comment\"\u003e// 4\u003c/span\u003e\n    \u003cspan class=\"hljs-variable\"\u003e$token\u003c/span\u003e = \u003cspan class=\"hljs-variable\"\u003e$user\u003c/span\u003e-\u003ecreateToken(\u003cspan class=\"hljs-variable\"\u003e$request\u003c/span\u003e-\u003edevice_name)-\u003eplainTextToken;\n\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e response()-\u003ejson([\u003cspan class=\"hljs-string\"\u003e'token'\u003c/span\u003e =\u003e \u003cspan class=\"hljs-variable\"\u003e$token\u003c/span\u003e], \u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e);\n}\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eHere’s a step by step breakdown of what this code does:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eWe validate the incoming request.\u003c/li\u003e\n\u003cli\u003eCheck the outcome of this validation. If it failed, return the errors in the response.\u003c/li\u003e\n\u003cli\u003eHash the password and create the new \u003ccode\u003eUser\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eCreate a token and save it so we can return it in the response.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eAs you can see, performing a successful request to this endpoint will return the generated token in the body of the response. However, to make sure our users don’t need to create a new account whenever they want to use the app on another device, let’s create the function to allow our users to request their token:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-php\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003etoken\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eRequest \u003cspan class=\"hljs-variable\"\u003e$request\u003c/span\u003e\u003c/span\u003e)\n\u003c/span\u003e{\n    \u003cspan class=\"hljs-comment\"\u003e// 1\u003c/span\u003e\n    \u003cspan class=\"hljs-variable\"\u003e$validator\u003c/span\u003e = Validator::make(\u003cspan class=\"hljs-variable\"\u003e$request\u003c/span\u003e-\u003eall(), [\n        \u003cspan class=\"hljs-string\"\u003e'email'\u003c/span\u003e =\u003e [\u003cspan class=\"hljs-string\"\u003e'required'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'string'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'email'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'max:255'\u003c/span\u003e],\n        \u003cspan class=\"hljs-string\"\u003e'password'\u003c/span\u003e =\u003e [\u003cspan class=\"hljs-string\"\u003e'required'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'string'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'min:8'\u003c/span\u003e],\n        \u003cspan class=\"hljs-string\"\u003e'device_name'\u003c/span\u003e =\u003e [\u003cspan class=\"hljs-string\"\u003e'required'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'string'\u003c/span\u003e]\n    ]);    \n    \n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-variable\"\u003e$validator\u003c/span\u003e-\u003efails()) {\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e response()-\u003ejson([\u003cspan class=\"hljs-string\"\u003e'error'\u003c/span\u003e =\u003e \u003cspan class=\"hljs-variable\"\u003e$validator\u003c/span\u003e-\u003eerrors()], \u003cspan class=\"hljs-number\"\u003e422\u003c/span\u003e);\n    }\n    \n    \u003cspan class=\"hljs-comment\"\u003e// 2\u003c/span\u003e\n    \u003cspan class=\"hljs-variable\"\u003e$user\u003c/span\u003e = User::where(\u003cspan class=\"hljs-string\"\u003e'email'\u003c/span\u003e, \u003cspan class=\"hljs-variable\"\u003e$request\u003c/span\u003e-\u003eemail)-\u003efirst();\n \n    \u003cspan class=\"hljs-comment\"\u003e// 3\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!\u003cspan class=\"hljs-variable\"\u003e$user\u003c/span\u003e || !Hash::check(\u003cspan class=\"hljs-variable\"\u003e$request\u003c/span\u003e-\u003epassword, \u003cspan class=\"hljs-variable\"\u003e$user\u003c/span\u003e-\u003epassword) {\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e response()-\u003ejson([\u003cspan class=\"hljs-string\"\u003e'error'\u003c/span\u003e =\u003e \u003cspan class=\"hljs-string\"\u003e'The provided credentials are incorrect.'\u003c/span\u003e], \u003cspan class=\"hljs-number\"\u003e422\u003c/span\u003e);\n    }\n    \n    \u003cspan class=\"hljs-comment\"\u003e// 4\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e response()-\u003ejson([\u003cspan class=\"hljs-string\"\u003e'token'\u003c/span\u003e =\u003e \u003cspan class=\"hljs-variable\"\u003e$user\u003c/span\u003e-\u003ecreateToken(\u003cspan class=\"hljs-variable\"\u003e$request\u003c/span\u003e-\u003edevice_name)-\u003eplainTextToken]);\n}\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eHere’s what this code does:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eWe once again validate the request, and return the errors if validation fails.\u003c/li\u003e\n\u003cli\u003eWe get the first \u003ccode\u003eUser\u003c/code\u003e from our database for the submitted email address. The email is unique, so at most this will return one user.\u003c/li\u003e\n\u003cli\u003eIf the user doesn’t exist (so the email was incorrect), or the password isn’t correct, we return an error the app can pick up.\u003c/li\u003e\n\u003cli\u003eWe return the generated token.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eThe scaffolding of our authentication is now complete! Let’s quickly create a route that’ll allow us to get the name of the logged in user.\u003c/p\u003e\n\u003cp\u003eIn your \u003ccode\u003eroutes/api.php\u003c/code\u003e file, add the following code:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-php\"\u003eRoute::middleware(\u003cspan class=\"hljs-string\"\u003e'auth:sanctum'\u003c/span\u003e)-\u003eget(\u003cspan class=\"hljs-string\"\u003e'/name'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003eRequest \u003cspan class=\"hljs-variable\"\u003e$request\u003c/span\u003e\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e response()-\u003ejson([\u003cspan class=\"hljs-string\"\u003e'name'\u003c/span\u003e =\u003e \u003cspan class=\"hljs-variable\"\u003e$request\u003c/span\u003e-\u003euser()-\u003ename]);\n});\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eHere we use the \u003ccode\u003e'auth:sanctum'\u003c/code\u003e middleware. This will make sure the api token is present in the headers of the request, and will return an error if it isn’t. When the request works, we can use \u003ccode\u003e$request-\u003euser()\u003c/code\u003e to get access to the user model.\u003c/p\u003e\n\u003cp\u003eThere’s a lot more I’d like to write about the things we can easily do with Sanctum, but I’ll refrain from doing so to keep this article short. If you want to learn more about the possibilities, like adding \u003cem\u003eabilities\u003c/em\u003e and revoking tokens, take a look at the \u003ca href=\"https://github.com/laravel/sanctum\"\u003edocumentation\u003c/a\u003e.\u003c/p\u003e\n\u003ch2\u003eLet’s authenticate\u003c/h2\u003e\n\u003cp\u003ehunter2 is not a valid password with the validation rules we defined.\u003c/p\u003e\n\u003cp\u003eIt’s time to put our api to the test. Let’s open up Xcode and quickly whip up a login screen. After doing whatever client side validation you want to perform, pass the values from the fields in your register form to the function you’ll use to perform the HTTP request. To provide code that can be used regardless of your preferred architecture, I’ll simply show you how to construct the request to register a user. Make sure to include the \u003ccode\u003eapplication/json\u003c/code\u003e \u003ccode\u003eContent-Type header\u003c/code\u003e, or your requests won’t succeed.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-swift\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e request \u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003eURLRequest\u003c/span\u003e(url: \u003cspan class=\"hljs-type\"\u003eURL\u003c/span\u003e(string: \u003cspan class=\"hljs-string\"\u003e\"http://yourprojecturl.test/api/sanctum/register\"\u003c/span\u003e)\u003cspan class=\"hljs-operator\"\u003e!\u003c/span\u003e)\nrequest.httpMethod \u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"POST\"\u003c/span\u003e\nrequest.addValue(\u003cspan class=\"hljs-string\"\u003e\"application/json\"\u003c/span\u003e, forHTTPHeaderField: \u003cspan class=\"hljs-string\"\u003e\"Content-Type\"\u003c/span\u003e)\n\u003cspan class=\"hljs-keyword\"\u003eguard\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e body \u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003etry?\u003c/span\u003e jsonEncoder.encode([\n    \u003cspan class=\"hljs-string\"\u003e\"name\"\u003c/span\u003e: name,\n    \u003cspan class=\"hljs-string\"\u003e\"password\"\u003c/span\u003e: password,\n    \u003cspan class=\"hljs-string\"\u003e\"email\"\u003c/span\u003e: email,\n    \u003cspan class=\"hljs-string\"\u003e\"device_name\"\u003c/span\u003e: deviceName\n]) \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e\n}\n\nrequest.httpBody \u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e body\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe request to log in is very similar, we simply replace the final url endpoint with \u003ccode\u003e/token\u003c/code\u003e and remove the \u003ccode\u003ename\u003c/code\u003e from the body. A successful request to any of these endpoints will result in the following response body:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-json\"\u003e{\n \u003cspan class=\"hljs-attr\"\u003e\"token\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;api token\u003e\"\u003c/span\u003e\n}\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAfter your user registers their account or logs in, make sure to store this token somewhere. We’ll use it in this next request to retrieve their name from the backend:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-swift\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e request \u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003eURLRequest\u003c/span\u003e(url: \u003cspan class=\"hljs-type\"\u003eURL\u003c/span\u003e(string: \u003cspan class=\"hljs-string\"\u003e\"http://yourprojecturl.test/api/name\"\u003c/span\u003e))\nrequest.httpMethod \u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"GET\"\u003c/span\u003e\nrequest.addValue(\u003cspan class=\"hljs-string\"\u003e\"Bearer \u003cspan class=\"hljs-subst\"\u003e\\(apiToken)\u003c/span\u003e\"\u003c/span\u003e, forHTTPHeaderField: \u003cspan class=\"hljs-string\"\u003e\"Authorization\"\u003c/span\u003e)\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eA quick recap\u003c/h2\u003e\n\u003cp\u003eLet’s briefly go over the things I explained in this article, to make sure we’re on the same page.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eWe set up some scaffolding with Laravel and Sanctum to handle user authentication.\u003c/li\u003e\n\u003cli\u003eWe can create routes using the \u003ccode\u003e'auth:sanctum'\u003c/code\u003e middleware that will validate the token sent in the headers, and gives us access to the corresponding user model.\u003c/li\u003e\n\u003cli\u003eWe can create the requests to consume our API.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003eNext steps\u003c/h2\u003e\n\u003cp\u003eAs I mentioned before, this just scratches the surface of what we can do with Sanctum. You can create tokens with different abilities so some users can perform actions while others can’t. Or you can set the token to expire after a certain amount of time, so the user has to request a new one. Sanctum is still in beta, so expect things to change and new features to be added.\u003c/p\u003e\n\u003cp\u003eHopefully this article gave you some insights in how Sanctum can be a simple alternative to other authorization methods. If you’re a mobile developer and you have never worked with Laravel before, I highly recommend spending some time with it. You’ll be able to build the backend for your apps in no time.\u003c/p\u003e\n\u003cp\u003eIf you have any questions, the best way to reach out to me is through \u003ca href=\"https://twitter.com/jillevd_w\"\u003eTwitter\u003c/a\u003e. If you like reading this, please let me know if you’d like to read more about Laravel, Swift, or a combination of the two.\u003c/p\u003e\n","ogImage":{"url":"/assets/blog/app-authentication-with-laravel-sanctum/cover.png"},"coverImage":"/assets/blog/app-authentication-with-laravel-sanctum/cover.png","darkCoverImage":"/assets/blog/app-authentication-with-laravel-sanctum/cover-dark.png"},"morePosts":[{"title":"Dynamic Routing and Static Generation","date":"2020-03-16T05:35:07.322Z","tags":["swift"],"slug":"dynamic-routing","coverImage":"/assets/blog/dynamic-routing/cover.jpg","darkCoverImage":"/assets/blog/dynamic-routing/cover.jpg"},{"title":"Learn How to Pre-render Pages Using Static Generation with Next.js","date":"2020-03-16T05:35:07.322Z","tags":["swift","combine"],"slug":"hello-world","coverImage":"/assets/blog/hello-world/cover.jpg","darkCoverImage":"/assets/blog/hello-world/cover.jpg"}],"headerColor":"text-blue-600"},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"app-authentication-with-laravel-sanctum"},"buildId":"bVcEAeUjTdMdFghfeYrz3","isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-144e5fa6fafab6397d9c.js"></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/framework.d2ae4074d0a54d95f68e.js" async=""></script><script src="/_next/static/chunks/commons.87599f097ee29829183b.js" async=""></script><script src="/_next/static/chunks/main-16077ccfe5cc6973aa9b.js" async=""></script><script src="/_next/static/chunks/pages/_app-548605a624d0e69fe54c.js" async=""></script><script src="/_next/static/chunks/bc82bb883724fe5faad984d18f20974d5cb6d361.fc1dc17d973ecd703ba3.js" async=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-8c19f52b3a53cda472a2.js" async=""></script><script src="/_next/static/bVcEAeUjTdMdFghfeYrz3/_buildManifest.js" async=""></script><script src="/_next/static/bVcEAeUjTdMdFghfeYrz3/_ssgManifest.js" async=""></script></body></html>